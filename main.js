(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>M});var t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error"},n=document.querySelector(".profile__name"),r=document.querySelector(".profile__description"),o=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__edit-button"),a=document.querySelector(".profile__add-button"),u=document.querySelector(".profile__avatar-edit"),i=(document.querySelectorAll(".popup"),document.querySelector(".popup_type_image")),l=i.querySelector(".popup__image"),s=i.querySelector(".popup__image-caption"),d=document.querySelector(".popup_type_addPlace"),p=document.querySelector(".popup_type_editProfile"),f=document.querySelector(".popup_type_editAvatar"),m=d.querySelector(".popup__input_content_place"),_=d.querySelector(".popup__input_content_link"),v=p.querySelector(".popup__input_content_name"),y=p.querySelector(".popup__input_content_description"),h=f.querySelector(".popup__input_avatar_link"),b=p.querySelector(".popup__form-editProfile"),S=d.querySelector(".popup__form-addPlace"),E=f.querySelector(".popup__form-editAvatar"),L=document.querySelector(".elements__list"),q=document.querySelector("#cardsListTemplate"),k=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");C(t)}},g=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",k)},C=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",k)},j=function(e){(e.target.classList.contains("modal-close")||e.target===e.currentTarget)&&C(e.currentTarget)},P=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disabled",!0))},A=function(e,t){return{inputList:Array.from(t.querySelectorAll(e.inputSelector)),buttonElement:t.querySelector(e.submitButtonSelector)}},x=function(e,t){!function(e,t){var n=A(e,t);P(e,n.inputList,n.buttonElement),n.inputList.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r}(e,t,n,n.validationMessage)}(e,t,r),P(e,n.inputList,n.buttonElement)}))}))}(e,t)},O={url:"https://mesto.nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"d8022b50-8c1c-4a15-ba76-94ce65b1ce67","Content-Type":"application/json"}};function T(e,t,n){e.textContent=t.likes.length,t.likes.forEach((function(e){M==e._id?n.classList.add("element__like-button_active"):n.classList.remove("element__like-button_active")}))}var w=function(e){L.prepend(e)},B=function(e){var t=q.content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__trash-button");t.querySelector(".element__title").textContent=e.name;var r=t.querySelector(".element__image"),o=t.querySelector(".element__likes-count"),c=t.querySelector(".element__like-button");return r.setAttribute("src",e.link),r.setAttribute("alt",e.name),T(o,e,c),t.dataset.id=e._id,M!=e.owner._id&&n.remove(),c.addEventListener("click",(function(e){!function(e,t,n,r){var o;e.target.classList.contains("element__like-button_active")?(o=n.dataset.id,fetch("".concat(O.url,"/cards/").concat(o,"/likes"),{method:"DELETE",headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){T(t,e,r)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(O.url,"/cards/").concat(e,"/likes"),{method:"PUT",headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n.dataset.id).then((function(e){T(t,e,r)})).catch((function(e){console.log(e)}))}(e,o,t,c)})),n.addEventListener("click",(function(e){!function(e,t){var n;(n=t.dataset.id,fetch("".concat(O.url,"/cards/").concat(n),{method:"DELETE",headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){e.target.closest(".element").remove()})).catch((function(e){console.log(e)}))}(e,t)})),t.querySelector(".element__image").addEventListener("click",(function(e){!function(e){var t=e.target.closest(".element__image"),n=t.src,r=t.alt;l.src=n,l.alt=r,s.textContent=r,g(i)}(e)})),t};function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var M="",N=function(e,t,n){A(n,t).buttonElement.textContent=e?"Сохранение...":"Сохранить"};function I(e){o.src=e}c.addEventListener("click",(function(){v.value=n.textContent,y.value=r.textContent,g(p);var e=A(t,b);P(t,e.inputList,e.buttonElement)})),a.addEventListener("click",(function(){g(d);var e=A(t,S);P(t,e.inputList,e.buttonElement)})),u.addEventListener("click",(function(){g(f);var e=A(t,f);P(t,e.inputList,e.buttonElement)})),p.addEventListener("click",j),d.addEventListener("click",j),i.addEventListener("click",j),f.addEventListener("click",j),S.addEventListener("submit",(function(e){e.preventDefault();var n={name:m.value,link:_.value};N(!0,S,t),function(e){return fetch("".concat(O.url,"/cards"),{method:"POST",headers:O.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(e){var t=B(e);w(t),C(d),S.reset()})).catch((function(e){console.log(e)})).finally((function(){N(!1,S,t)}))})),b.addEventListener("submit",(function(e){e.preventDefault();var o={name:v.value,about:y.value};N(!0,b,t),function(e){return fetch("".concat(O.url,"/users/me"),{method:"PATCH",headers:O.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o).then((function(e){n.textContent=e.name,r.textContent=e.about,C(p)})).catch((function(e){console.log(e)})).finally((function(){N(!1,b,t)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var n,r={avatar:h.value};N(!0,E,t),(n=r,fetch("".concat(O.url,"/users/me/avatar"),{method:"PATCH",headers:O.headers,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){I(e.avatar),E.reset(),C(f)})).catch((function(e){console.log(e)})).finally((function(){N(!1,E,t)}))})),x(t,S),x(t,b),x(t,E),Promise.all([fetch("".concat(O.url,"/users/me"),{headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(O.url,"/cards"),{headers:O.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t,o,c=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(u.push(r.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,o)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=c[0],u=c[1];M=a._id,n.textContent=a.name,r.textContent=a.about,I(a.avatar),u.reverse(),u.forEach((function(e){var t=B(e);w(t)}))})).catch((function(e){console.log(e)}))})();