(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>N});var t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error"},n=document.querySelector(".profile__name"),o=document.querySelector(".profile__description"),r=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__edit-button"),u=document.querySelector(".profile__add-button"),i=document.querySelector(".profile__avatar-edit"),a=(document.querySelectorAll(".popup"),document.querySelector(".popup_type_image")),s=a.querySelector(".popup__image"),l=a.querySelector(".popup__image-caption"),d=document.querySelector(".popup_type_addPlace"),p=document.querySelector(".popup_type_editProfile"),f=document.querySelector(".popup_type_editAvatar"),m=d.querySelector(".popup__input_content_place"),_=d.querySelector(".popup__input_content_link"),v=p.querySelector(".popup__input_content_name"),h=p.querySelector(".popup__input_content_description"),y=f.querySelector(".popup__input_avatar_link"),S=p.querySelector(".popup__form-editProfile"),b=d.querySelector(".popup__form-addPlace"),q=f.querySelector(".popup__form-editAvatar"),E=document.querySelector(".elements__list"),L=document.querySelector("#cardsListTemplate"),k=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");C(t)}},g=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",k)},C=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",k)},j=function(e){(e.target.classList.contains("modal-close")||e.target===e.currentTarget)&&C(e.currentTarget)},P=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disabled",!0))},x=function(e,t){return{inputList:Array.from(t.querySelectorAll(e.inputSelector)),buttonElement:t.querySelector(e.submitButtonSelector)}},A=function(e,t){!function(e,t){var n=x(e,t);P(e,n.inputList,n.buttonElement),n.inputList.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o}(e,t,n,n.validationMessage)}(e,t,o),P(e,n.inputList,n.buttonElement)}))}))}(e,t)},T={url:"https://mesto.nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"d8022b50-8c1c-4a15-ba76-94ce65b1ce67","Content-Type":"application/json"}};function O(e,t){e.textContent=t.likes.length}function B(e){e.target.classList.toggle("element__like-button_active")}var D=function(e){E.prepend(e)},w=function(e){var t=L.content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__trash-button");t.querySelector(".element__title").textContent=e.name;var o=t.querySelector(".element__image"),r=t.querySelector(".element__likes-count");return o.setAttribute("src",e.link),o.setAttribute("alt",e.name),O(r,e),t.dataset.id=e._id,N!=e.owner._id&&n.remove(),t.querySelector(".element__like-button").addEventListener("click",(function(e){!function(e,t,n){var o;e.target.classList.contains("element__like-button_active")?(o=n.dataset.id,fetch("".concat(T.url,"/cards/").concat(o,"/likes"),{method:"DELETE",headers:T.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(n){O(t,n),B(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(T.url,"/cards/").concat(e,"/likes"),{method:"PUT",headers:T.headers})}(n.dataset.id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(n){O(t,n),B(e)})).catch((function(e){console.log(e)}))}(e,r,t)})),n.addEventListener("click",(function(e){!function(e,t){var n;(n=t.dataset.id,fetch("".concat(T.url,"/cards/").concat(n),{method:"DELETE",headers:T.headers})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e.target.closest(".element").remove()})).catch((function(e){console.log(e)}))}(e,t)})),t.querySelector(".element__image").addEventListener("click",(function(e){!function(e){var t=e.target.closest(".element__image"),n=t.src,o=t.alt;s.src=n,s.alt=o,l.textContent=o,g(a)}(e)})),t},N="",J=function(e,t,n){x(n,t).buttonElement.textContent=e?"Сохранение...":"Сохранить"},M=function(){fetch("".concat(T.url,"/users/me"),{headers:T.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){N=e._id,n.textContent=e.name,o.textContent=e.about,r.src=e.avatar})).catch((function(e){console.log(e)}))};M(),fetch("".concat(T.url,"/cards"),{headers:T.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=w(e);D(t)}))})).catch((function(e){console.log(e)})),c.addEventListener("click",(function(){v.value=n.textContent,h.value=o.textContent,g(p);var e=x(t,S);P(t,e.inputList,e.buttonElement)})),u.addEventListener("click",(function(){g(d);var e=x(t,b);P(t,e.inputList,e.buttonElement)})),i.addEventListener("click",(function(){g(f);var e=x(t,f);P(t,e.inputList,e.buttonElement)})),p.addEventListener("click",j),d.addEventListener("click",j),a.addEventListener("click",j),f.addEventListener("click",j),b.addEventListener("submit",(function(e){e.preventDefault();var n={name:m.value,link:_.value};J(!0,b,t),function(e){return fetch("".concat(T.url,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify(e)})}(n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=w(e);D(t),C(d),b.reset()})).catch((function(e){console.log(e)})).finally((function(){J(!1,b,t)}))})),S.addEventListener("submit",(function(e){e.preventDefault();var r={name:v.value,about:h.value};J(!0,S,t),function(e){return fetch("".concat(T.url,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify(e)})}(r).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){n.textContent=e.name,o.textContent=e.about,C(p)})).catch((function(e){console.log(e)})).finally((function(){J(!1,S,t)}))})),q.addEventListener("submit",(function(e){e.preventDefault();var n,o={avatar:y.value};J(!0,q,t),(n=o,fetch("".concat(T.url,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify(n)})).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){M(),q.reset(),C(f)})).catch((function(e){console.log(e)})).finally((function(){J(!1,q,t)}))})),A(t,b),A(t,S),A(t,q)})();